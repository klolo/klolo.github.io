
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Java stream reduce vs collect - Łódzki programista</title>
  <meta name="author" content="Kamil Lolo">

  
  <meta name="description" content="Pracując z strumieniami Javy 8 pojawia się czasami konieczność złączenia wszystkich elementów strumienia w jakiś obiekt wynikowy. Taką operacje
można &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://klolo.github.io/blog/2017/08/09/stream-reduce-vs-collect">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="Łódzki programista" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-104079933-1', 'auto');
    ga('send', 'pageview');
</script>

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header style="text-align: center" role="banner"><img src="/images/logo.png" />
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script>
  <script type='text/javascript'>kofiwidget2.init('Buy me a coffee', '#25baf1', 'A187461B');kofiwidget2.draw();</script>
</ul>
  
<ul class="main-navigation">
  <li><a href="/">Programowanie</a></li>
  <li><a href="/lodz">Łódź</a></li>
  <li><a href="/blog/archives">Archiwum</a></li>
  <li><a href="/about">O mnie</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <progress value="0" id="progressBar">
  <div class="progress-container">
    <span class="progress-bar"></span>
  </div>
</progress>

<div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">Java stream reduce vs collect</h1>
    
  
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-08-09T22:13:08+02:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:13 pm</span></time>
        
        
      </p>
    
  </header>


<div class="entry-content"><p>Pracując z strumieniami Javy 8 pojawia się czasami konieczność złączenia wszystkich elementów strumienia w jakiś obiekt wynikowy. Taką operacje
można wykonać zarówno za pomocą metody reduce, jak również za pomocą collect. Jaka jest różnica między tymi metodami i na jaki problem można się natknąć
korzystając z tych metod?</p>

<!--more-->


<p>Zarówno metoda reduce jak i collect są operacjami terminalnymi strumienia. Co oznacza tyle że ich wynikiem nie jest strumień na którym można dalej wykonywać
operacje, ale jakiś wynikowy obiekt. Na początek spójrzmy na to jakie parametry przyjmują te metody.</p>

<h2>Collect</h2>

<p>Metoda Collect ma dwie przeciążone wersje:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">R</span> <span class="nf">collect</span><span class="o">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">supplier</span><span class="o">,</span>
                  <span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">R</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">,</span>
                  <span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">R</span><span class="o">,</span> <span class="n">R</span><span class="o">&gt;</span> <span class="n">combiner</span><span class="o">);</span>

<span class="o">&lt;</span><span class="n">R</span><span class="o">,</span> <span class="n">A</span><span class="o">&gt;</span> <span class="n">R</span> <span class="nf">collect</span><span class="o">(</span><span class="n">Collector</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">,</span> <span class="n">A</span><span class="o">,</span> <span class="n">R</span><span class="o">&gt;</span> <span class="n">collector</span><span class="o">);</span></code></pre></div>


<p>Tak więc metoda wymaga podania od nas trzech parametrów, bądź też obiektu <em>Collector</em>&hellip;zaraz zaraz, ale co znajduje się w tym obiekcie? Znajdziemy tam takie metody jak:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="nf">supplier</span><span class="o">();</span>
<span class="n">BiConsumer</span><span class="o">&lt;</span><span class="n">A</span><span class="o">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="nf">accumulator</span><span class="o">();</span>
<span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="nf">combiner</span><span class="o">();</span></code></pre></div>


<p>Wygląda na to że klasa <em>Collector</em> służy jako obiekt w którym możemy ukryć implementację 3 wymaganych przez metodę collect parametrów. Razem z JDK dostajemy
kilka gotowych implementacji tej klasy. Za pomocą metod statycznych w klasie <em>Collectors</em> mamy możliwość dostać się do tych gotowych implementacji. Dodam jeszcze że te gotowce pokrywają 90%
przypadków z jakimi się spotkałem. Jakie metody statyczne w klasie <em>Collectors</em> są najczęściej używane?</p>

<h2>Collectors</h2>

<p>Te najczęściej wykorzystywane to:</p>

<ul>
<li><code>toList</code> - pozwala zaagregować elementy strumienia w postaci listy.
Gdzie domyślna implementacja to <em>ArrayList</em>. Spójrzmy na przykład wykorzystania:</li>
</ul>


<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="o">...</span> <span class="n">getters</span><span class="o">/</span><span class="n">setters</span><span class="o">...</span>
    <span class="o">}</span>
    <span class="o">...</span>
    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Max&quot;</span><span class="o">,</span> <span class="mi">18</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Peter&quot;</span><span class="o">,</span> <span class="mi">23</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Pamela&quot;</span><span class="o">,</span> <span class="mi">24</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;David&quot;</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>

    <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">adultUsers</span> <span class="o">=</span> <span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toList</span><span class="o">());</span></code></pre></div>


<p>W powyższym kodzie wszystkie przefiltrowane elementy strumienia, czyli osoby pełnoletnie zostaną umieszczone w liście która będzie wynikiem działania obiektu <em>Collector</em>, utworzonego metodą fabrykującą toList.</p>

<ul>
<li><code>toCollection</code> - pozwala zaagregować elementy strumienia w postaci kolekcji podanego typu.</li>
</ul>


<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">adultUsers</span> <span class="o">=</span> <span class="n">persons</span>
                  <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                  <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="o">)</span>
                  <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toCollection</span><span class="o">(</span><span class="nl">LinkedList:</span><span class="o">:</span><span class="k">new</span><span class="o">));</span></code></pre></div>


<ul>
<li><code>toSet</code> - agreguje elementy strumienia w zbiór.</li>
</ul>


<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">adultUserSet</span> <span class="o">=</span> <span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toSet</span><span class="o">());</span></code></pre></div>


<ul>
<li><code>toMap</code> - łączy elementy strumienia w mapę. W najprostszej wersji wymaga podania funkcji tworzącej klucze do mapy i funkcji zwracającej elementy dla klucza. Dostępne sa również przeciążone wersje
metody przyjmujące również funkcje do rozwiązywania kolizji wstawianych obiektów oraz <em>Supplier</em> za pomocą którego można utworzyć mapę. Utwórzmy więc mapę w której kluczem jest imię użytkownika, a wartością jego wiek:</li>
</ul>


<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">adultMap</span> <span class="o">=</span> <span class="n">persons</span>
            <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">user</span><span class="o">.</span><span class="na">age</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="o">)</span>
            <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">toMap</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getName</span><span class="o">,</span> <span class="nl">Person:</span><span class="o">:</span><span class="n">getAge</span><span class="o">));</span></code></pre></div>


<h2>Parametry metody Collect</h2>

<p>Znając już kilka głównych implementacji klasy Collector, przyjrzyjmy się do czego tak naprawdę metoda collect wykorzystuje dostarczone klasie Collect bądź jako osobne parametry
implementacje metod supplier, accumulator, combiner. Pierwszy parametr trójargumentowej wersji metody collect to <em>Supplier</em>. Jest to funkcja bez argumentowa która zwraca
jakiś obiekt. Ten właśnie obiekt jest naszym obiektem wynikowym, który będzie gromadził pozostałe elementy strumienia. Tutaj najczęściej wykorzystuje sie metody fabrykujące, bądź też
referencję do konstruktora bez argumentowego. Kolejny parametr, to obiekt typu <em>BiConsumer</em>, czyli funkcja przyjmująca dwa parametry i nic nie zwracająca. Służy ona do łączenia poszczególnych elementów strumienia.
Jako pierwszy parametr w <em>BiConsumer</em> dostaniemy obiekt który utworzyliśmy poprzez <em>Supplier</em>, a drugim elementem jest obiekt strumienia który należy zaagregować. Tak naprawdę te dwie metody w zupełności
wystarczą żeby metoda collect zadziałała. Spójrzmy na przykład:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Max&quot;</span><span class="o">,</span> <span class="mi">18</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Peter&quot;</span><span class="o">,</span> <span class="mi">23</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Pamela&quot;</span><span class="o">,</span> <span class="mi">24</span><span class="o">),</span>
                <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;David&quot;</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>

     <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span>
                        <span class="nl">LinkedList:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span>
                        <span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;accumulator: &quot;</span> <span class="o">+</span> <span class="n">result</span> <span class="o">+</span> <span class="s">&quot; =&gt; &quot;</span> <span class="o">+</span> <span class="n">element</span>
                            <span class="o">);</span>
                            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
                        <span class="o">},</span>
                        <span class="o">(</span><span class="n">p1</span><span class="o">,</span> <span class="n">p2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                <span class="s">&quot;combiner: &quot;</span> <span class="o">+</span> <span class="n">p1</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">p2</span>
                            <span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">);</span></code></pre></div>


<p>Wynikiem działania takiego kodu będzie:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nl">accumulator:</span> <span class="o">[]</span> <span class="o">=&gt;</span> <span class="n">Max</span>
      <span class="nl">accumulator:</span> <span class="o">[</span><span class="n">Max</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="n">Peter</span>
      <span class="nl">accumulator:</span> <span class="o">[</span><span class="n">Max</span><span class="o">,</span> <span class="n">Peter</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="n">Pamela</span>
      <span class="nl">accumulator:</span> <span class="o">[</span><span class="n">Max</span><span class="o">,</span> <span class="n">Peter</span><span class="o">,</span> <span class="n">Pamela</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="n">David</span></code></pre></div>


<p>Jak widać trzecia przekazana, tajemnicza funkcja nie uruchomiła się. Czy więc jest potrzebna? Jest! Ale tylko w przetwarzaniu równoległym strumieni. Jak wiemy strumienie mogą być dzielone na podstrumienie
dzięki <em>ForkJoinPool</em>. Są one wtedy przetwarzane w osobnych wątkach. Każdy z tych wątków po zakończeniu pracy musi swój wyniki złączyć z danymi obliczonymi w innych watkach. Za takie złączenie
odpowiada ta ostatnia funkcja - <em>combiner</em>. Przekazywana jest ona jako obiekt typu <em>BinaryOperator</em>. Jaki będzie wynik działa strumienia uruchomionego równolegle w osobnym wątku?
Będzie to oczywiście obiekt również utworzony za pomocą przekazanego obiektu <em>supplier</em>. A tak to wygląda w praktyce:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">persons</span>
                <span class="o">.</span><span class="na">parallelStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span>
                        <span class="o">()</span> <span class="o">-&gt;{</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;create list&quot;</span><span class="o">);</span>
                            <span class="k">return</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;&gt;();</span>
                        <span class="o">},</span>
                        <span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="n">element</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                            <span class="kd">final</span> <span class="n">String</span> <span class="n">threadName</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                    <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">threadName</span> <span class="o">+</span> <span class="s">&quot;] accumulator: &quot;</span> <span class="o">+</span> <span class="n">result</span> <span class="o">+</span> <span class="s">&quot; + &quot;</span> <span class="o">+</span> <span class="n">element</span>
                            <span class="o">);</span>
                            <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
                        <span class="o">},</span>
                        <span class="o">(</span><span class="n">subResult1</span><span class="o">,</span> <span class="n">subResult2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                            <span class="kd">final</span> <span class="n">String</span> <span class="n">threadName</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
                                    <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="n">threadName</span> <span class="o">+</span> <span class="s">&quot;] combine: &quot;</span> <span class="o">+</span> <span class="n">subResult1</span> <span class="o">+</span> <span class="s">&quot; + &quot;</span> <span class="o">+</span> <span class="n">subResult2</span>
                            <span class="o">);</span>
                            <span class="n">subResult1</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">subResult2</span><span class="o">);</span>
                        <span class="o">}</span>
                <span class="o">);</span></code></pre></div>


<p>Gdzie wynikiem działania kodu będzie:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">create</span> <span class="n">list</span>
<span class="n">create</span> <span class="n">list</span>
<span class="n">create</span> <span class="n">list</span>
<span class="n">create</span> <span class="n">list</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">2</span><span class="o">]</span> <span class="nl">accumulator:</span> <span class="o">[]</span> <span class="o">+</span> <span class="n">David</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="nl">accumulator:</span> <span class="o">[]</span> <span class="o">+</span> <span class="n">Peter</span>
<span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="nl">accumulator:</span> <span class="o">[]</span> <span class="o">+</span> <span class="n">Pamela</span>
<span class="n">create</span> <span class="n">list</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">3</span><span class="o">]</span> <span class="nl">accumulator:</span> <span class="o">[]</span> <span class="o">+</span> <span class="n">Max</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="nl">accumulator:</span> <span class="o">[]</span> <span class="o">+</span> <span class="n">Zosia</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="nl">combine:</span> <span class="o">[</span><span class="n">Zosia</span><span class="o">]</span> <span class="o">+</span> <span class="o">[</span><span class="n">David</span><span class="o">]</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="nl">combine:</span> <span class="o">[</span><span class="n">Pamela</span><span class="o">]</span> <span class="o">+</span> <span class="o">[</span><span class="n">Zosia</span><span class="o">,</span> <span class="n">David</span><span class="o">]</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">3</span><span class="o">]</span> <span class="nl">combine:</span> <span class="o">[</span><span class="n">Max</span><span class="o">]</span> <span class="o">+</span> <span class="o">[</span><span class="n">Peter</span><span class="o">]</span>
<span class="o">[</span><span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">commonPool</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="mi">3</span><span class="o">]</span> <span class="nl">combine:</span> <span class="o">[</span><span class="n">Max</span><span class="o">,</span> <span class="n">Peter</span><span class="o">]</span> <span class="o">+</span> <span class="o">[</span><span class="n">Pamela</span><span class="o">,</span> <span class="n">Zosia</span><span class="o">,</span> <span class="n">David</span><span class="o">]</span></code></pre></div>


<p>Należy zwrócić tutaj uwagę na kilka rzeczy:
  * obiekt <em>LinkedList</em> został utworzony aż 5 razy i tylko jeden z tych obiektów jest tym który dostaniemy jako wynik operacji, pozostałe służą jako obiekty tymczasowe do których mogą być zapisywane
  dane w osobnych wątkach.
  * accumulator w pierwszym parametrze dostał listę, która aktualnie jest procesowana w danym wątku, a jako drugi parametr obiekt który należy zaagregować. Zachowanie identyczne jak w przetwarzaniu jednowątkowym.
  * wreszcie został uruchomiony combiner. Dostał on jako pierwszy parametry dwie listy. Pierwsza jest obiektem wynikowym, jaki zostanie zwrócony z metody <em>collect</em>, a drugi jest wynikiem działania strumienia w osobnym
  wątku.</p>

<p>Oczywiście powyższy przykład można znacznie uprościć korzystając z referencji do metod:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">persons</span>
                <span class="o">.</span><span class="na">parallelStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span>
                        <span class="nl">LinkedList:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span>
                        <span class="nl">LinkedList:</span><span class="o">:</span><span class="n">add</span><span class="o">,</span>
                        <span class="nl">LinkedList:</span><span class="o">:</span><span class="n">addAll</span>
                <span class="o">);</span></code></pre></div>


<p>Podsumowując działanie metody <em>collect</em>. Przyjmuje ona 3 parametry. Pierwszy odpowiada za utworzenie obiektu który będzie przechowywał dane z strumienia, za pomocą drugiej możemy agregować elementy, natomiast trzecia
łączy wyniki pracy strumienia w osobnym wątku z obiektem wyjściowym. Tak więc o parametrze <em>agregate</em> można powiedzieć że służy on do dopisywania danych do wynikowego obiektu, który tworzony jest raz i jest
<em>mutowalny</em></p>

<h2>Reduce:</h2>

<p>Tak, tak te słowo jest tutaj kluczowe. Ponieważ metoda <em>reduce</em> różni się właśnie tym że została przystosowana o pracy z nie mutowalnymi obiektami. Metoda ta również jest przeciążona:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">T</span> <span class="nf">reduce</span><span class="o">(</span><span class="n">T</span> <span class="n">identity</span><span class="o">,</span> <span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">);</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">reduce</span><span class="o">(</span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">);</span>
<span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="n">U</span> <span class="nf">reduce</span><span class="o">(</span><span class="n">U</span> <span class="n">identity</span><span class="o">,</span>
                 <span class="n">BiFunction</span><span class="o">&lt;</span><span class="n">U</span><span class="o">,</span> <span class="o">?</span> <span class="kd">super</span> <span class="n">T</span><span class="o">,</span> <span class="n">U</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">,</span>
                 <span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span> <span class="n">combiner</span><span class="o">);</span></code></pre></div>


<p>Na początek przyjrzyjmy się tej pierwszej wersji metody. Przyjmuje ona jako pierwszy parametr obiekt takiego samego typu jak ten wynikowy z metody <em>reduce</em>. Przykładowo jeżeli <em>reduce</em> miało by złączyć
wszystkie elementy strumienia typu integer do jednej liczby, to właśnie jak pierwszy parametr należy podać liczbę do której będą dodawane kolejne. Drugi parametr to metoda za pomocą której będą łączone
elementy strumienia. Zobaczmy jako to wygląda w praktyce:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">Integer</span> <span class="n">adults</span> <span class="o">=</span> <span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mapToInt</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getAge</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span>
                        <span class="mi">0</span><span class="o">,</span>
                        <span class="o">(</span><span class="n">sum</span><span class="o">,</span> <span class="n">age</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">age</span>
                <span class="o">);</span></code></pre></div>


<p>Po utworzeniu strumienia obiektów typu Person zamieniamy strumień obiektów na strumień intów w celu uniknięcia zbędnego boxingu. Następnie do liczby 0, która jst naszym parametrem identity zaczynamy
dodawać kolejne obiekty strumienia, otrzymując w rezultacie zsumowany wiek ludzi z danej kolekcji. Tak na marginesie identycznie działanie ma metoda <em>sum</em> i z niej powinniśmy korzystać w prawdziwym kodzie :)</p>

<p>Druga wersja metody <em>reduce</em> pozwala nam pominąć przekazywanie początkowej wartości, jednak zwraca wynik jako obiekt typu <em>Optional</em>.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mapToInt</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getAge</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">)</span>
                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">print</span><span class="o">);</span></code></pre></div>


<p>Trzecia wersja metody wymaga od nas przekazania również obiektu <em>combiner</em>. Który podobnie jako to miało miejsce w funkcji collect łączy wyniki pracy osobnych strumieni.</p>

<h2>Pułapka metody reduce</h2>

<p>W powyższych przykładach wykorzystania metody <em>reduce</em> posłużyłem się dodawaniem intów. Przyjrzyjmy się teraz troszkę innemu przykładowi:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getName</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span>
                        <span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span>
                <span class="o">);</span></code></pre></div>


<p>Jaki jest problem z tym kodem? Jest nie optymalny. Przy każdym wywołaniu stringi łączone są za pomocą konkatenacji. Zobaczmy jak wygląda najbardziej trywialne porównanie szybkości działania
metody reduce oraz collect:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">persons</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="mi">1_0000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">persons</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;James&quot;</span><span class="o">,</span> <span class="mi">18</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getName</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nl">StringBuilder:</span><span class="o">:</span><span class="k">new</span><span class="o">,</span>
                        <span class="nl">StringBuilder:</span><span class="o">:</span><span class="n">append</span><span class="o">,</span>
                        <span class="nl">StringBuilder:</span><span class="o">:</span><span class="n">append</span>
                <span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="s">&quot; ms&quot;</span><span class="o">);</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

        <span class="n">persons</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Person:</span><span class="o">:</span><span class="n">getName</span><span class="o">)</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span>
                        <span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span>
                <span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">+</span> <span class="s">&quot; ms&quot;</span><span class="o">);</span></code></pre></div>


<p>Co daje wynik:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="mi">18</span> <span class="n">ms</span>  <span class="c1">// collect + StringBuilder</span>
<span class="mi">217</span> <span class="n">ms</span> <span class="c1">// reduce + konkatenacja</span></code></pre></div>


<p>Widać że mamy tutaj różnice jednego rzędu wielkości. Tak na marginesie, łączenie Stringów za pomocą <em>collect</em> jest już zaimplementowane. W klasie Collectors mamy do dyspozycji przeciążoną
metodę <em>joining</em>, zwracającą <em>Collector</em> który robi to w optymalny sposób.</p>

<h2>Podsumowanie</h2>

<p>Artykuł przybliżył działanie funkcji <em>reduce</em> oraz <em>collect</em>. Na przykładach zobaczyliśmy jak działają te funkcje oraz za co odpowiadają ich parametry. Przedstawiłem również kilka gotowych implementacji
klasy <em>Collector</em>, które rozwiązują najczęściej występujące problemy. Na koniec zobaczyliśmy na jaki problem można się natknąć przy używaniu reduce w błędny sposób.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Kamil Lolo</span></span>

      




<time class='entry-date' datetime='2017-08-09T22:13:08+02:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>10:13 pm</span></time>
    </p>
    <p class="meta">
      Kategoria: 

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://klolo.github.io/blog/2017/08/09/stream-reduce-vs-collect/" data-via="" data-counturl="http://klolo.github.io/blog/2017/08/09/stream-reduce-vs-collect/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/08/08/mantra-architektoniczna/" title="Previous Post: Mantra architektoniczna">&laquo; Mantra architektoniczna</a>
      
      
        <a class="basic-alignment right" href="/blog/2017/08/15/intellij-live-templates-szybsze-programowanie/" title="Next Post: Intellij live templates - szybsze programowanie">Intellij live templates - szybsze programowanie &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2021/03/07/spring-boot-wystawianie-endpointow-na-wielu-portach/">[spring boot] Wystawianie endpointów na wielu portach</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/03/07/java-zwiezle-deklarowanie-beanow/">Java: zwięzłe deklarowanie beanów</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/18/dependency-injection-w-js/">Dependency injection w js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/12/17/w-oczekiwaniu-na-jave-10/">W oczekiwaniu na Java 10</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/28/dlugie-metody-w-kodzie-udany-przepis-na-bledy/">Długie metody w kodzie – udany przepis na błędy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/17/dlaczego-obiekty-niezmienne-w-projekcie-to-blogoslawienstwo-i-o-tym-jak-nie-pisac-testow/">Dlaczego obiekty niezmienne w projekcie to błogosławieństwo i o tym jak nie pisać testów</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/14/pierwsze-spotkanie-z-react/">Pierwsze spotkanie z React</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/09/17/typescript-wprowadzenie-czesc-2/">Typescript wprowadzenie - część 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/09/03/zaimplementuj-dependency-injection-w-typescript/">Zaimplementuj dependency injection w Typescript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/08/28/java-stream-api-darmowy-kurs/">Java stream API - darmowy kurs</a>
      </li>
    
  </ul>
</section>

<section>
  <h2>  
    <a href="https://github.com/klolo">@klolo</a> on GitHub
    
  </h2>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>

  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'klolo',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


<!-- Pasek postepu podczas czytania -->
<script>
    $(document).ready(function(){
        var getMax = function(){
            return $(document).height() - $(window).height();
        }

        var getValue = function(){
            return $(window).scrollTop();
        }

        if('max' in document.createElement('progress')){
            // Browser supports progress element
            var progressBar = $('progress');

            // Set the Max attr for the first time
            progressBar.attr({ max: getMax() });

            $(document).on('scroll', function(){
                // On scroll only Value attr needs to be calculated
                progressBar.attr({ value: getValue() });
            });

            $(window).resize(function(){
                // On resize, both Max/Value attr needs to be calculated
                progressBar.attr({ max: getMax(), value: getValue() });
            });
        }
        else {
            var progressBar = $('.progress-bar'),
                max = getMax(),
                value, width;

            var getWidth = function(){
                // Calculate width in percentage
                value = getValue();
                width = (value/max) * 100;
                width = width + '%';
                return width;
            }

            var setWidth = function(){
                progressBar.css({ width: getWidth() });
            }

            $(document).on('scroll', setWidth);
            $(window).on('resize', function(){
                // Need to reset the Max attr
                max = getMax();
                setWidth();
            });
        }
    });


    $(document).ready(function(){
        $('#flat').addClass("active");
        $('#progressBar').addClass('flat');

        $('#flat').on('click', function(){
            $('#progressBar').removeClass().addClass('flat');
            $('a').removeClass();
            $(this).addClass('active');
            $(this).preventDefault();
        });

        $('#single').on('click', function(){
            $('#progressBar').removeClass().addClass('single');
            $('a').removeClass();
            $(this).addClass('active');
            $(this).preventDefault();
        });

        $('#multiple').on('click', function(){
            $('#progressBar').removeClass().addClass('multiple');
            $('a').removeClass();
            $(this).addClass('active');
            $(this).preventDefault();
        });

        $('#semantic').on('click', function(){
            $('#progressBar').removeClass().addClass('semantic');
            $('a').removeClass();
            $(this).addClass('active');
            $(this).preventDefault();
            alert('hello');
        });
    });
</script>
    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - Kamil Lolo <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, customized with <a href="https://github.com/mjhea0/whiterspace">whiterspace</a>.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'klolo-github-io';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://klolo.github.io/blog/2017/08/09/stream-reduce-vs-collect/';
        var disqus_url = 'http://klolo.github.io/blog/2017/08/09/stream-reduce-vs-collect/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
